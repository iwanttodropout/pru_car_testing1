<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Car Insurance + Free Diffuser</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />

  <style>
    /* Your existing CSS here... (unchanged) */
  </style>
</head>
<body>
  <div id="progress-bar"></div>

  <header data-aos="fade-down">
    <h1>Drive with Confidence — and a Fresh Ride</h1>
    <p>Unlock a <strong>FREE Aroma Diffuser</strong> when you purchase your car insurance with us.</p>
    <a href="#quote-form" class="cta-button">Get My Freebie Now!</a>
  </header>

  <section class="benefits" data-aos="fade-up">
    <!-- Your existing benefits section -->
  </section>

  <section class="visual" data-aos="fade-up">
    <!-- Your existing visual section -->
  </section>

  <section id="quote-form" data-aos="zoom-in">
    <h2 class="section-title">Let’s Get Started!</h2>
    <form id="quoteForm">
      <input type="text" name="name" placeholder="Your Name" required />
      <input type="tel" name="contact" placeholder="Contact Number" maxlength="8" required title="Enter a valid 8-digit number starting with 8 or 9" />
      <input type="email" name="email" placeholder="Email Address" required title="Enter a valid email address" />
      <input type="text" name="_gotcha" style="display:none" />
      <p id="errorMsg" style="color: red; display: none; margin-top: 0.5rem;"></p>
      <button id="submitButton" type="submit">Submit</button>
    </form>
    <p class="disclaimer">*We respect your privacy. No spam, ever.</p>
    <p class="pdpa">
      By submitting this form, you consent to the collection, use, and disclosure of your personal data in accordance with our 
      <a href="#" target="_blank">Privacy Policy</a>, and the Personal Data Protection Act (PDPA).
    </p>
  </section>

  <script>
    // Scroll progress bar
    window.onscroll = function () {
      const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrolled = (winScroll / height) * 100;
      document.getElementById("progress-bar").style.width = scrolled + "%";
    };

    // Smooth scroll for CTA
    document.querySelector('.cta-button').addEventListener('click', function(e) {
      e.preventDefault();
      const target = document.querySelector('#quote-form');
      const startPosition = window.pageYOffset;
      const targetPosition = target.getBoundingClientRect().top + startPosition;
      const distance = targetPosition - startPosition;
      const duration = 1450;
      let start = null;
      function easeInOutQuad(t, b, c, d) {
        t /= d/2;
        if (t < 1) return c/2*t*t + b;
        t--;
        return -c/2 * (t*(t-2) - 1) + b;
      }
      function animation(currentTime) {
        if (start === null) start = currentTime;
        const timeElapsed = currentTime - start;
        const run = easeInOutQuad(timeElapsed, startPosition, distance, duration);
        window.scrollTo(0, run);
        if (timeElapsed < duration) requestAnimationFrame(animation);
      }
      requestAnimationFrame(animation);
    });

    // Form submission (keeps your current API + adds SendGrid)
    document.getElementById("quoteForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const form = e.target;
      const name = form.name.value.trim();
      const email = form.email.value.trim();
      const contact = form.contact.value.trim();
      const errorMsg = document.getElementById("errorMsg");
      const button = document.getElementById("submitButton");

      // Inline validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      const contactRegex = /^[89]\d{7}$/;

      if (!name || !emailRegex.test(email) || !contactRegex.test(contact)) {
        errorMsg.style.display = "block";
        errorMsg.textContent = "Please enter valid info in all fields!";
        return;
      }

      errorMsg.style.display = "none";
      button.disabled = true;
      button.classList.add("loading");
      button.textContent = "Submitting...";

      try {
        // Your existing API
        const res = await fetch("/api/handler", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, email, contact }),
        });
        const result = await res.json();
        if (!res.ok) throw new Error(result.message || "Submission failed.");

        // SendGrid API
        await fetch("/api/sendgrid", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, email, contact }),
        });

        alert("Form submitted! Check your email for confirmation.");
        form.reset();

      } catch (err) {
        errorMsg.style.display = "block";
        errorMsg.textContent = err.message;
      } finally {
        button.disabled = false;
        button.classList.remove("loading");
        button.textContent = "Submit";
      }
    });
  </script>

  <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
  <script>AOS.init();</script>
</body>
</html>
